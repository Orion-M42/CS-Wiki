> 参考 http://c.biancheng.net/springcloud/open-feign.html

Netflix Feign 是 Netflix 公司发布的一种实现负载均衡和服务调用的开源组件。Spring Cloud 将其与 Netflix 中的其他开源服务组件（例如 Eureka、Ribbon 以及 Hystrix 等）一起整合进了 Spring Cloud Netflix 模块中，整合后全称为 Spring Cloud Netflix Feign

**【Feign 对 Ribbon 和 Hystrix 进行了集成】，利用 Ribbon 维护了一份可用服务清单，并通过 Ribbon 实现了客户端的负载均衡**。

**Feign 是一种声明式服务调用组件，它在 RestTemplate 的基础上做了进一步的封装**。通过 Feign，我们只需要声明一个接口并通过注解进行简单的配置（类似于 Dao 接口上面的 Mapper 注解一样）即可实现对 HTTP 接口的绑定。

通过 Feign，我们可以像调用本地方法一样来调用远程服务，而完全感觉不到这是在进行远程调用。

Feign 支持多种注解，例如 Feign 自带的注解以及 JAX-RS 注解等，但遗憾的是 Feign 本身并不支持 Spring MVC 注解，这无疑会给广大 Spring 用户带来不便

> 2019 年 Netflix 公司宣布 Feign 组件正式进入停更维护状态，于是 Spring 官方便推出了一个名为 **OpenFeign** 的组件作为 Feign 的替代方案。

## 代码示例

> 参考 https://blog.didispace.com/spring-cloud-starter-dalston-2-3/

下面的例子，我们将利用之前构建的`eureka-server`作为服务注册中心、`eureka-client`作为服务提供者作为基础。而基于Spring Cloud Ribbon实现的消费者，我们可以根据`eureka-consumer`实现的内容进行简单改造就能完成，具体步骤如下：

- 根据`eureka-consumer`复制一个服务消费者工程，命名为：`eureka-consumer-feign`。在`pom.xml`中增加下面的依赖：

```properties
<dependencies>
    ...
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-feign</artifactId>
    </dependency>
</dependencies>
```

- 修改应用主类。通过`@EnableFeignClients`注解开启扫描Spring Cloud Feign客户端的功能：

```java
@EnableFeignClients
@EnableDiscoveryClient
@SpringBootApplication
public class Application {

	public static void main(String[] args) {
		new SpringApplicationBuilder(Application.class).web(true).run(args);
	}
}
```

- 创建一个Feign的客户端接口定义。使用`@FeignClient`注解来指定这个接口所要调用的服务名称，接口中定义的各个函数使用Spring MVC的注解就可以来绑定服务提供方的REST接口，比如下面就是绑定`eureka-client`服务的`/dc`接口的例子：

```java
@FeignClient("eureka-client")
public interface DcClient {

    @GetMapping("/dc")
    String consumer();

}
```

- 修改Controller。通过定义的feign客户端来调用服务提供方的接口：

```java
@RestController
public class DcController {

    @Autowired
    DcClient dcClient;

    @GetMapping("/consumer")
    public String dc() {
        return dcClient.consumer();
    }

}
```

通过Spring Cloud Feign来实现服务调用的方式更加简单了，**通过`@FeignClient`定义的接口来统一的生命我们需要依赖的微服务接口。而在具体使用的时候就跟调用本地方法一点的进行调用即可**。

由于Feign是基于Ribbon实现的，所以它自带了客户端负载均衡功能，也可以通过Ribbon的 IRule 进行策略扩展。

另外，Feign还整合了 Hystrix 来实现服务的容错保护，在 Dalston 版本中，Feign的Hystrix默认是关闭的。待后文介绍Hystrix带领大家入门之后，我们再结合介绍Feign中的Hystrix以及配置方式。

在完成了上面你的代码编写之后，读者可以将eureka-server、eureka-client、eureka-consumer-feign都启动起来，然后访问http://localhost:2101/consumer ，来跟踪观察eureka-consumer-feign服务是如何消费eureka-client服务的`/dc`接口的，并且也可以通过启动多个eureka-client服务来观察其负载均衡的效果。