## CAP 理论

> In a distributed system (a collection of **interconnected** nodes that **share data**), you can only have two out of the following three guaranteed **across a write/read pair**（涉及到读写操作的时候）: `Consistency`, `Availability`, and `Partition Tolerance` - **one of them must be sacrificed**.

- **Consistency**：A read is guaranted to return the most recent write for a given client

- **Availability**：A non-failing node will return a reasonable response within a reasonable amount of time(no error or timeout). 非故障的节点在合理的时间内返回合理的响应（当然，这个响应不能是错误 or 超时的响应）

- **Partition Tolerance**：The System will continue to function when network partitions occur. 发生网络分区的时候仍然能够正常工作

  > 什么是网络分区？之前一直理解的就是不同的服务器，大错特错
  >
  > 网络分区事实上是一种**故障类型**！当不同节点分布在不同的子网络中时，在内部子网络正常的情况下，由于某些原因导致这些子节点之间出现网络不通的情况，导致整个系统环境被切分成若干个独立的区域

## CAP 应用

分布式环境下 P 是必然要素，所以 CAP 架构只能在 CP 和 AP 架构中做选择

CP 举例：不一致的数据我宁愿返回 Error！

![](https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/image-20221115171943931.png)

AP 举例：不一致的数据我也返回给你

![](https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/image-20221115172015567.png)

## CAP 细节

- **CAP 关注的粒度是数据，而不是系统**：就是说一个系统的不同数据模块可以采用不同的 CAP 架构，比如用户账号数据用 CP，用户信息（昵称、兴趣、爱好）用 AP
- **正常情况下，不存在 CP 和 AP 的选择，可以同时满足 CA**；所以架构设计时既要考虑正常情况即不发生分区时如何保证 CA，也需要考虑发生分区时选择 CP 还是 AP
- **放弃 C or 放弃 A 并不等于什么都不做！！！**比如我们可以在分区期间记录一些日志，当分区故障解决后，系统根据日志进行数据恢复，使得重新达到 CA 状态

## BASE

核心思想：如果无法做到强一致性（CAP 的 C 就是强一致性），那就保证最终一致性。**所以 BASE 理论其实是 CAP 中 AP 方案的延伸和补充**

- Basically Available（基本可用）
- Soft State（软状态）
- Eventual Consistency（最终一致性）